<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PIXEL-NET Arcade</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">

  <!-- cache-busted -->
  <link rel="stylesheet" href="style.css?v=8" />
</head>
<body>

  <!-- Top-right initials badge -->
  <button id="px-player-badge" class="px-badge" type="button">???</button>

  <!-- Initials entry card -->
  <section id="px-initials-card" class="px-initcard" aria-hidden="true">
    <div class="px-initcard__inner">
      <div class="px-initcard__top">
        <div class="px-initcard__title">WELCOME TO PIXEL-NET</div>
        <button id="px-initcard-close" class="px-initcard__close" type="button">×</button>
      </div>

      <div class="px-initcard__sub">
        Enter your initials to tag scores across games.
      </div>

      <div class="px-initcard__row">
        <input id="px-initials-input"
               class="px-initcard__input"
               type="text"
               maxlength="3"
               placeholder="TJW"
               autocomplete="off"
               autocapitalize="characters"
               spellcheck="false" />
        <button id="px-initials-save" class="px-initcard__btn">SAVE</button>
      </div>

      <div id="px-initials-error" class="px-initcard__error"></div>
      <div class="px-initcard__hint">
        Press <b>Enter</b> to save. Click initials to change later.
      </div>
    </div>
  </section>

  <!-- HEADER -->
  <header class="site-header">
    <div class="brand">
      <div class="brand-mark">PX</div>
      <div class="brand-text">
        <div class="brand-title">PIXEL-NET</div>
        <div class="brand-subtitle">Online Arcade Network</div>
      </div>
    </div>

    <nav class="nav">
      <a class="nav-link" href="#featured-game">Featured</a>
      <a class="nav-link" href="#game-library">Library</a>
      <a class="nav-link" href="#leaderboards">Leaderboards</a>
    </nav>
  </header>

  <main class="wrap">

    <!-- FEATURED -->
    <section id="featured-game" class="section">
      <div class="featured-card">
        <div class="featured-media">
          <img id="featuredThumb" src="assets/millipede_thumb.png" alt="Featured Game">
          <div class="featured-glow"></div>
          <div class="scanlines"></div>
        </div>

        <div class="featured-info">
          <span class="badge">Game of the Week</span>
          <h2 id="featuredTitle">Loading…</h2>
          <p class="muted">Play games. Set records. Become a Top Dog.</p>
          <button id="featuredPlay" class="btn">Play Featured</button>
        </div>
      </div>
    </section>

    <!-- LIBRARY -->
    <section id="game-library" class="section">
      <div class="section-head px-headrow">
        <div>
          <h3>Arcade Floor</h3>
          <p class="muted">Pick a cabinet. Click to play.</p>
        </div>
        <input id="px-search" class="px-search" type="search" placeholder="Search games…" />
      </div>

      <div id="arcadeGrid" class="game-grid"></div>
      <div id="px-empty" class="px-empty muted" style="display:none;">
        No games match your search.
      </div>
    </section>

    <!-- LEADERBOARDS -->
    <section id="leaderboards" class="section">
      <div class="section-head">
        <h3>Top Dogs</h3>
        <p class="muted">Players holding #1 scores the longest.</p>
      </div>

      <!-- THIS IS WHAT JS FILLS -->
      <div id="topdogs-panel" class="px-board"></div>
    </section>

  </main>

  <footer class="footer wrap">
    <div class="muted">CREATED BY TYLER WAGGONER WITH THE USE OF AI</div>
    <div class="muted">PIXEL-NET • Static GitHub Pages</div>
  </footer>

  <!-- ================= INITIALS LOGIC ================= -->
  <script>
    (function () {
      const LS = "px_player_initials";
      const SS = "playerInitials";

      const badge = document.getElementById("px-player-badge");
      const card = document.getElementById("px-initials-card");
      const input = document.getElementById("px-initials-input");
      const error = document.getElementById("px-initials-error");

      function norm(v) {
        return (v || "").toUpperCase().replace(/[^A-Z0-9]/g, "").slice(0, 3);
      }
      function get() {
        return localStorage.getItem(LS) || sessionStorage.getItem(SS) || "";
      }
      function set(v) {
        localStorage.setItem(LS, v);
        sessionStorage.setItem(SS, v);
      }
      function show() {
        card.classList.add("is-open");
        input.value = get();
        input.focus();
        input.select();
      }
      function hide() {
        card.classList.remove("is-open");
        error.textContent = "";
      }
      function save() {
        const v = norm(input.value);
        if (!v) {
          error.textContent = "Enter 1–3 characters.";
          return;
        }
        set(v);
        badge.textContent = v;
        hide();
      }

      badge.onclick = show;
      document.getElementById("px-initcard-close").onclick = () => get() && hide();
      document.getElementById("px-initials-save").onclick = save;
      input.onkeydown = e => e.key === "Enter" && save();

      const v = get();
      badge.textContent = v || "???";
      if (!v) show();
    })();
  </script>

  <!-- ================= GAMES LOADER ================= -->
  <script>
    function normalizeGame(g) {
      return {
        name: g.name || g.title || "UNTITLED",
        thumb: g.thumb || g.image || "assets/millipede_thumb.png",
        path: g.path || g.url || ""
      };
    }

    function renderGrid(list) {
      const grid = document.getElementById("arcadeGrid");
      const empty = document.getElementById("px-empty");
      grid.innerHTML = "";

      if (!list.length) {
        empty.style.display = "block";
        return;
      }
      empty.style.display = "none";

      list.forEach(g => {
        const card = document.createElement("div");
        card.className = "game-card";
        card.innerHTML = `<img src="${g.thumb}"><h4>${g.name}</h4>`;
        card.onclick = () => location.href = g.path;
        grid.appendChild(card);
      });
    }

    fetch("./games.json", { cache: "no-store" })
      .then(r => r.json())
      .then(raw => {
        const games = raw.map(normalizeGame);

        const f = games[0];
        if (f) {
          document.getElementById("featuredThumb").src = f.thumb;
          document.getElementById("featuredTitle").textContent = f.name;
          document.getElementById("featuredPlay").onclick = () => location.href = f.path;
        }

        renderGrid(games);

        document.getElementById("px-search").oninput = e => {
          const q = e.target.value.toLowerCase();
          renderGrid(games.filter(g => g.name.toLowerCase().includes(q)));
        };
      });
  </script>

  <!-- ================= LEADERBOARD WIRING ================= -->
  <script src="js/leaderboard.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      renderTopDogs("topdogs-panel");
      setInterval(() => renderTopDogs("topdogs-panel"), 30000);
    });
  </script>

</body>
</html>
