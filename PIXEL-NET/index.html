<script>
    async function loadGames() {
        try {
            // Updated to look in the current folder for games.json
            const response = await fetch('games.json'); 
            const games = await response.json();
            const grid = document.getElementById('arcadeGrid');
            grid.innerHTML = '';

            games.forEach(game => {
                const cab = document.createElement('div');
                cab.className = 'cabinet';
                cab.setAttribute('data-name', game.title.toLowerCase());
                
                // Ensure image paths are relative to the folder
                cab.innerHTML = `
                    <div class="cabinet-screen" onclick="launchGame('${game.script}')">
                        <img src="${game.image}" class="cabinet-thumb" style="width:100%; height:100%; object-fit:cover;">
                    </div>
                    <div style="font-weight:bold; margin-top:10px;">${game.title}</div>
                    <div style="font-size:0.8em; color:#888;">${game.description}</div>
                `;
                grid.appendChild(cab);
            });

            // Update Featured Hero
            if(games.length > 0) {
                const hero = games[0];
                document.getElementById('heroTitle').innerText = "ðŸ”¥ FEATURE: " + hero.title;
                document.getElementById('heroSubtitle').innerText = hero.description;
                document.getElementById('heroButton').onclick = () => launchGame(hero.script);
            }
        } catch (e) { 
            console.error("Load Error:", e);
            alert("System Error: Could not load games.json. Check file location.");
        }
    }

    function launchGame(scriptPath) {
        // Clear old game instances
        const old = document.getElementById('active-cart');
        if(old) old.remove();

        const script = document.createElement('script');
        // This ensures it looks in the 'js' folder relative to index.html
        script.src = scriptPath; 
        script.id = 'active-cart';
        
        script.onerror = () => alert("ERROR: Could not find game file at " + scriptPath);
        
        document.body.appendChild(script);
        document.getElementById('gameOverlay').style.display = 'flex';
    }

    function closeGame() { 
        document.getElementById('gameOverlay').style.display = 'none'; 
        window.location.reload(); 
    }

    function enterArcade() { 
        document.getElementById('loginGate').style.display = 'none'; 
    }

    window.onload = loadGames;
</script>
