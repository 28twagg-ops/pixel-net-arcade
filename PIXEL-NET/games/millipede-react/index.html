<!-- FORCE_PAGES_REDEPLOY -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MILLIPEDE CHAOS</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">

  <style>

:root{
  --text:#e9ecff;
  --muted:#a7b0d6;
  --card1:rgba(15,19,36,.72);
  --card2:rgba(10,12,26,.55);
  --stroke:rgba(255,255,255,.10);
  --shadow:0 14px 40px rgba(0,0,0,.35);
  --radius:22px;
  --gap:18px;
  --topbarH:54px;
  --tabsH:44px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  height:100dvh;
  overflow:hidden; /* prevent page jumping; panels scroll internally */
  color:var(--text);
  background:
    radial-gradient(1200px 700px at 20% 0%, rgba(158,66,255,.24), transparent 55%),
    radial-gradient(1200px 700px at 90% 10%, rgba(0,186,255,.18), transparent 55%),
    linear-gradient(180deg,#070812 0%, #050611 55%, #040510 100%);
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
}

/* Version pill */
#pn-version-pill{
  position:fixed;
  left:10px; top:10px;
  z-index:99999;
  padding:6px 10px;
  border-radius:999px;
  background:rgba(0,0,0,.55);
  border:1px solid var(--stroke);
  box-shadow:var(--shadow);
  font:700 12px/1 Orbitron, ui-sans-serif, system-ui;
  letter-spacing:.08em;
}

/* Top bar */
.topbar{
  position:fixed;
  left:0; right:0; top:0;
  z-index:9999;
  height:var(--topbarH);
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:10px 14px;
  pointer-events:none;
}
.topbar > *{pointer-events:auto}

.btn{
  border:1px solid var(--stroke);
  background:rgba(0,0,0,.35);
  color:var(--text);
  padding:10px 14px;
  border-radius:999px;
  font:800 14px/1 Orbitron, ui-sans-serif, system-ui;
  letter-spacing:.08em;
  cursor:pointer;
}
.btn:hover{background:rgba(255,255,255,.06)}
.badge{
  border:1px solid var(--stroke);
  background:rgba(0,0,0,.35);
  padding:10px 14px;
  border-radius:999px;
  font:900 14px/1 Orbitron, ui-sans-serif, system-ui;
  letter-spacing:.12em;
}

/* Layout grid */
.layout{
  height:100dvh;
  padding:calc(var(--topbarH) + 10px) 14px 14px;
  display:grid;
  grid-template-columns: minmax(260px, 360px) minmax(420px, 1fr) minmax(260px, 360px);
  gap:var(--gap);
  align-items:stretch;
}
.panel{
  background:linear-gradient(180deg,var(--card1),var(--card2));
  border:1px solid var(--stroke);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:16px 16px 14px;
  min-height:0; /* allow inner scroll */
  display:flex;
  flex-direction:column;
}
.title{
  margin:0 0 12px;
  font:900 16px/1.1 Orbitron, ui-sans-serif, system-ui;
  letter-spacing:.08em;
  text-transform:uppercase;
}
.muted{color:var(--muted);font-size:14px;line-height:1.45}
.hint{color:var(--muted);font-size:12px;line-height:1.45;margin-top:10px}

/* Center game */
main.panel{padding-bottom:12px}
.gamebox{
  flex:1 1 auto;
  min-height:0;
  display:flex;
  align-items:center;
  justify-content:center;
}
.gameframe{
  height:min(88dvh, 980px);
  max-height:100%;
  aspect-ratio:20/32;
  width:auto;
  max-width:100%;
  border-radius:18px;
  overflow:hidden;
  background:#000;
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 10px 30px rgba(0,0,0,.35) inset;
}
#root{width:100%;height:100%}

/* Leaderboard */
.lb-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
  margin-top:10px;
  min-height:0;
}
.lb-col{
  list-style:none;
  padding:0;
  margin:0;
  display:flex;
  flex-direction:column;
  gap:8px;
}
.lb-col li{
  display:flex;
  justify-content:space-between;
  gap:10px;
  padding:7px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.08);
  background:rgba(0,0,0,.22);
  font:800 13px/1 Orbitron, ui-sans-serif, system-ui;
}
.lb-meta{margin-top:auto;color:var(--muted);font-size:12px;padding-top:12px}

/* Mobile tabs (hidden on desktop) */
.mobile-tabs{display:none}

/* Mobile / narrow screens */
@media (max-width: 860px){
  :root{--gap:12px}
  .layout{
    grid-template-columns: 1fr;
    padding:calc(var(--topbarH) + 10px) 10px 10px;
    gap:12px;
  }
  /* tabs show */
  .mobile-tabs{
    display:flex;
    gap:8px;
    margin-bottom:10px;
    align-items:center;
    flex-wrap:wrap;
  }
  .mobile-tabs{position:sticky; top:calc(var(--topbarH) + 6px); z-index:20; backdrop-filter: blur(6px);}

  .tab-btn{
    flex:1 1 auto;
    min-width:110px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.28);
    color:var(--text);
    padding:10px 12px;
    border-radius:999px;
    font:900 12px/1 Orbitron, ui-sans-serif, system-ui;
    letter-spacing:.08em;
    cursor:pointer;
  }
  .tab-btn.is-active{background:rgba(255,255,255,.10)}
    /* Mobile: keep main panel, hide side panels; tabs swap views inside main */
  aside.panel{display:none !important}
  main.panel{display:flex !important}
  /* Make game bigger on mobile */
  .gameframe{height:min(72dvh, 720px)}
}

/* Tab views (inside main, used on mobile) */
.tabviews{width:100%}
.view{display:none;width:100%}
.view.is-active{display:block}
@media (min-width: 861px){
  /* Desktop: always show game view; hide mobile-only views */
  .view[data-view="howto"], .view[data-view="lb"]{display:none !important}
  .view[data-view="game"]{display:block}
}
.hidden{display:none !important}

/* Initials modal */
.px-init-modal{
  position:fixed; inset:0;
  display:flex; align-items:center; justify-content:center;
  z-index:200;
}
.px-init-modal.hidden{display:none !important}
.px-init-backdrop{position:absolute; inset:0; background:rgba(0,0,0,.55); backdrop-filter: blur(4px);}
.px-init-card{
  position:relative;
  width:min(420px, calc(100vw - 26px));
  background:linear-gradient(180deg,var(--card1),var(--card2));
  border:1px solid var(--stroke);
  border-radius:18px;
  box-shadow:var(--shadow);
  padding:14px;
}
.px-init-header{display:flex; align-items:center; justify-content:space-between; font:900 13px/1 Orbitron, ui-sans-serif, system-ui; letter-spacing:.12em;}
#px-init-close{border:0;background:transparent;color:var(--text);font-size:22px;cursor:pointer; padding:0 6px;}
#px-init-input{
  width:100%;
  margin-top:12px;
  padding:12px 14px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(0,0,0,.25);
  color:var(--text);
  font:900 28px/1.1 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
  letter-spacing:.18em;
  text-transform:uppercase;
}
#px-init-save{
  width:100%;
  margin-top:12px;
  padding:12px 14px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(255,255,255,.10);
  color:var(--text);
  font:900 13px/1 Orbitron, ui-sans-serif, system-ui;
  letter-spacing:.12em;
  cursor:pointer;
}
#px-init-save:hover{background:rgba(255,255,255,.14)}
.px-init-hint{margin-top:10px; color:var(--muted); font-size:12px;}

</style>

  <!-- React build -->
  <script type="module" crossorigin src="./assets/index-BTthQfIO.js"></script>
</head>
<body>

<section id="px-init-modal" class="px-init-modal hidden" aria-hidden="true">
  <div class="px-init-backdrop"></div>
  <div class="px-init-card" role="dialog" aria-modal="true" aria-label="Enter Initials">
    <div class="px-init-header">
      <span>ENTER INITIALS</span>
      <button id="px-init-close" type="button" aria-label="Close">×</button>
    </div>
    <input id="px-init-input" type="text" maxlength="3" placeholder="_ _ _" autocomplete="off"
      autocapitalize="characters" spellcheck="false" />
    <button id="px-init-save" type="button">SAVE</button>
    <div class="px-init-hint">Press Enter to save</div>
  </div>
</section>
<div id="pn-version-pill">V1.8</div>

  <div class="topbar">
    <button class="btn" id="px-exit">EXIT</button>
    <div class="badge" id="px-badge" title="Click to change initials">???</div>
  </div>

  <div class="layout">
    <aside class="panel" data-panel="howto">
      <h3 class="title">HOW TO PLAY</h3>
      <div class="muted">
        <p><b>Move:</b> Arrow Keys / WASD</p>
        <p><b>Shoot:</b> Space</p>
        <p><b>Goal:</b> Clear the swarm, survive, score high.</p>
        <p><b>DDT Bomb:</b> shoot it to create a gas cloud that clears enemies.</p>
        <p><b>Poison:</b> poisoned mushrooms make the millipede dive downward.</p>

      </div>
      <div class="hint">Initials are set on the homepage. Click the badge (top-right) to change.</div>
      <div class="hint"><b>Game Over:</b> score auto-saves. Press <b>Enter</b> to restart.</div>
    </aside>

    <main class="panel" data-panel="game">
      <h3 class="title">MILLIPEDE CHAOS</h3>
      <div class="mobile-tabs" role="tablist" aria-label="Millipede tabs">
        <button class="tab-btn is-active" data-tab="game" type="button">GAME</button>
        <button class="tab-btn" data-tab="howto" type="button">HOW TO PLAY</button>
        <button class="tab-btn" data-tab="lb" type="button">LEADERBOARD</button>
</div>
      <div class="tabviews">
        <section class="view is-active" data-view="game">


      <div class="gamebox">
        <div class="gameframe" id="px-gameframe">
          <div id="root"></div>
        </div>
</div>
      </div>
      <div class="muted">Leaderboard refreshes automatically.</div>
    
        </section>
        <section class="view" data-view="howto">

      <h3 class="title">HOW TO PLAY</h3>
      <div class="muted">
        <p><b>Move:</b> Arrow Keys / WASD</p>
        <p><b>Shoot:</b> Space</p>
        <p><b>Goal:</b> Clear the swarm, survive, score high.</p>
        <p><b>DDT Bomb:</b> shoot it to create a gas cloud that clears enemies.</p>
        <p><b>Poison:</b> poisoned mushrooms make the millipede dive downward.</p>

      </div>
      <div class="hint">Initials are set on the homepage. Click the badge (top-right) to change.</div>
      <div class="hint"><b>Game Over:</b> score auto-saves. Press <b>Enter</b> to restart.</div>
    
        </section>
        <section class="view" data-view="lb">
          <h3 class="title">LEADERBOARD</h3>
          <div class="muted">Top 10</div>
          <div class="lb-grid">
            <ol class="lb-col" id="lb-left-m"></ol>
            <ol class="lb-col" id="lb-right-m"></ol>
          </div>
          <div class="lb-meta" id="lb-status-m">Loading…</div>
        </section>
      </div>

    </main>

    <aside class="panel" data-panel="lb">
      <h3 class="title">LEADERBOARD</h3>
      <div class="muted">Top 10</div>
      <div class="lb-grid">
        <ol class="lb-col" id="lb-left"></ol>
        <ol class="lb-col" id="lb-right"></ol>
      </div>
      <div class="lb-meta" id="lb-status">Loading…</div>
    </aside>
  </div>

  <script src="../../js/engine.js"></script>
  <script>
    (function(){
      const SLUG = "millipede-react";

      function norm(v){ return String(v||"").toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0,3) || "???"; }
      const initials = norm(localStorage.getItem("px_player_initials") || sessionStorage.getItem("playerInitials") || "???");

      // Keep storages in sync for PixelNet + the React build (various keys observed)
      sessionStorage.setItem("playerInitials", initials);
      try{
        localStorage.setItem("p", initials);
        localStorage.setItem("u", initials);
        localStorage.setItem("n", initials);
        localStorage.setItem("nm", initials);
      }catch(_){}

      if(window.PixelNet && PixelNet.init) PixelNet.init();

      const badge = document.getElementById("px-badge");
      badge.textContent = initials || "???";
      document.getElementById("px-exit").onclick = () => location.href = "../../index.html";

      // ---- Initials modal (badge click) ----
      const modal = document.getElementById("px-init-modal");
      const modalInput = document.getElementById("px-init-input");
      const modalSave = document.getElementById("px-init-save");
      const modalClose = document.getElementById("px-init-close");
      const backdrop = modal ? modal.querySelector(".px-init-backdrop") : null;

      function openInitials(){
        if(!modal) return;
        modal.classList.remove("hidden");
        modal.setAttribute("aria-hidden","false");
        if(modalInput){
          modalInput.value = initials;
          setTimeout(()=>modalInput.focus(), 0);
          modalInput.select?.();
        }
      }
      function closeInitials(){
        if(!modal) return;
        modal.classList.add("hidden");
        modal.setAttribute("aria-hidden","true");
      }
      function applyInitials(v){
        const nv = norm(v);
        localStorage.setItem("px_player_initials", nv);
        sessionStorage.setItem("playerInitials", nv);
        try{
          localStorage.setItem("p", nv);
          localStorage.setItem("u", nv);
          localStorage.setItem("n", nv);
          localStorage.setItem("nm", nv);
        }catch(_){}
        badge.textContent = nv;
      }

      badge.addEventListener("click", openInitials);
      if(modalClose) modalClose.addEventListener("click", closeInitials);
      if(backdrop) backdrop.addEventListener("click", closeInitials);

      if(modalSave){
        modalSave.addEventListener("click", ()=>{
          applyInitials(modalInput ? modalInput.value : "");
          closeInitials();
        });
      }
      if(modalInput){
        modalInput.addEventListener("keydown", (e)=>{
          if(e.key === "Enter"){ e.preventDefault(); applyInitials(modalInput.value); closeInitials(); }
          if(e.key === "Escape"){ e.preventDefault(); closeInitials(); }
        });
        modalInput.addEventListener("input", ()=>{
          modalInput.value = norm(modalInput.value);
        });
      }


      // ---- Mobile tabs ----
      const views = Array.from(document.querySelectorAll('.tabviews .view[data-view]'));
      const tabBtns = Array.from(document.querySelectorAll('.mobile-tabs .tab-btn[data-tab]'));

      function setActive(tab){
        // swap views (inside main)
        views.forEach(v=>{
          v.classList.toggle('is-active', v.getAttribute('data-view') === tab);
        });
        tabBtns.forEach(b=>{
          b.classList.toggle('is-active', b.getAttribute('data-tab') === tab);
        });
      }

      // Default: show GAME view
      setActive('game');

      tabBtns.forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const tab = btn.getAttribute('data-tab');
          if(tab) setActive(tab);
        });
      });
      

