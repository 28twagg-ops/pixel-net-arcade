<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Robo-Arena (v2) — PIXEL-NET</title>

<style>
:root{
  --bgA:#05060a;
  --bgB:#070a12;

  --text:#eaf2ff;
  --muted:rgba(234,242,255,.72);

  --stroke:rgba(255,255,255,.10);
  --stroke2:rgba(255,255,255,.14);

  --accent:#00cfff;   /* cyan */
  --accent2:#ff2bd6;  /* magenta */
  --accent3:#a8ff00;  /* lime */

  --radius:22px;
  --radius2:18px;

  --shadow:0 18px 60px rgba(0,0,0,.55);
  --shadowSoft:0 10px 30px rgba(0,0,0,.35);

  --font:system-ui,-apple-system,"Segoe UI",Roboto,Arial;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  color:var(--text);
  font-family:var(--font);
  overflow:hidden;

  background:
    radial-gradient(1100px 650px at 18% 12%, rgba(255,43,43,.22), transparent 62%),
    radial-gradient(980px 560px at 88% 16%, rgba(0,207,255,.18), transparent 62%),
    linear-gradient(135deg,var(--bgA), var(--bgB));
}

/* top bar (Creek Crosser format: EXIT | TITLE | PLAYER) */
.topbar{
  height:62px;
  display:grid;
  grid-template-columns: 1fr auto 1fr;
  align-items:center;
  padding:0 14px;
  border-bottom:1px solid var(--stroke);
  background:rgba(0,0,0,.22);
  backdrop-filter: blur(10px);
}

.pillBtn{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:10px 14px;
  border-radius:999px;
  border:1px solid var(--stroke2);
  background:rgba(0,0,0,.22);
  color:var(--text);
  font-weight:900;
  letter-spacing:.06em;
  cursor:pointer;
  user-select:none;
  text-decoration:none;
}
.pillBtn:hover{filter:brightness(1.06)}
.pillBtn .x{font-weight:900;opacity:.9}

.titlePill{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:10px 18px;
  border-radius:999px;
  border:1px solid color-mix(in srgb, var(--accent3) 55%, var(--stroke2));
  background:rgba(0,0,0,.22);
  box-shadow:0 0 0 2px rgba(168,255,0,.12) inset;
  font-weight:900;
  letter-spacing:.14em;
  text-transform:uppercase;
}

.rightPills{
  justify-self:end;
  display:flex;
  gap:10px;
}
.playerPill{
  display:inline-flex;
  align-items:center;
  gap:10px;
  padding:10px 14px;
  border-radius:999px;
  border:1px solid var(--stroke2);
  background:rgba(0,0,0,.22);
  font-weight:900;
  letter-spacing:.08em;
  text-transform:uppercase;
  cursor:pointer;
  user-select:none;
}
.playerPill strong{color:var(--accent);letter-spacing:.18em}
.playerPill:hover{filter:brightness(1.06)}

/* layout */
.wrap{
  height:calc(100% - 62px);
  padding:14px;
}
.grid{
  height:100%;
  display:grid;
  grid-template-columns: 320px 1fr 320px;
  gap:14px;
}

.panel{
  height:100%;
  border-radius:var(--radius);
  border:1px solid var(--stroke);
  background:rgba(0,0,0,.18);
  box-shadow:var(--shadowSoft);
  overflow:hidden;
  display:flex;
  flex-direction:column;
}
.panelHeader{
  padding:14px 16px;
  font-weight:1000;
  letter-spacing:.14em;
  text-transform:uppercase;
  border-bottom:1px solid var(--stroke);
  background:rgba(0,0,0,.22);
}
.panelBody{
  padding:14px 16px;
  overflow:hidden;
}

/* allow scroll only in leaderboard if needed */
#pLB .panelBody{overflow:auto;}

.bullets{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:12px}
.bullet{
  display:flex;
  gap:12px;
  align-items:flex-start;
  padding:12px 12px;
  border-radius:18px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.18);
}
.dot{
  width:10px;height:10px;border-radius:999px;
  margin-top:6px;
  background:var(--accent3);
  box-shadow:0 0 0 2px rgba(168,255,0,.14);
}
.bulletText{line-height:1.25;color:rgba(234,242,255,.85);font-weight:700}
.bulletText b{color:var(--text);font-weight:1000}

/* cabinet (uniform scale NO stretch) */
.cabinetOuter{
  height:100%;
  padding:14px;
}
.cabinetInner{
  height:100%;
  border-radius:20px;
  border:1px solid rgba(168,255,0,.25);
  background:rgba(0,0,0,.18);
  box-shadow:0 0 0 2px rgba(168,255,0,.08) inset;
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
}
.frameSizer{
  width:var(--fitW, 640px);
  height:var(--fitH, 480px);
  border-radius:18px;
  border:1px solid rgba(255,255,255,.12);
  background:#000;
  overflow:hidden;
  box-shadow:0 18px 60px rgba(0,0,0,.6);
}
iframe{
  width:100%;
  height:100%;
  border:0;
  display:block;
  background:#000;
}

/* leaderboard */
.note{color:rgba(234,242,255,.68);font-weight:700;margin:0 0 10px 0}
#lb{display:flex;flex-direction:column;gap:10px}
.lbEmpty{padding:12px 12px;border-radius:16px;border:1px solid rgba(255,255,255,.10);background:rgba(0,0,0,.18);color:rgba(234,242,255,.8);font-weight:800}
.lbRow{
  display:grid;
  grid-template-columns: 60px 1fr auto;
  align-items:center;
  padding:12px 12px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.18);
  gap:10px;
  font-weight:900;
}
.lbRank{color:rgba(234,242,255,.7)}
.lbWho{letter-spacing:.16em;text-transform:uppercase}
.lbScore{color:var(--accent);letter-spacing:.08em}

/* mobile tabs */
.tabs{
  display:none;
  position:absolute;
  left:0;right:0;bottom:0;
  padding:12px 14px;
  background:linear-gradient(to top, rgba(0,0,0,.75), rgba(0,0,0,0));
}
.tabRow{
  display:grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap:10px;
}
.tabBtn{
  padding:12px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.20);
  color:rgba(234,242,255,.85);
  font-weight:1000;
  letter-spacing:.08em;
  text-transform:uppercase;
  cursor:pointer;
}
.tabBtn.active{
  border-color:color-mix(in srgb, var(--accent) 60%, rgba(255,255,255,.18));
  box-shadow:0 0 0 2px rgba(0,207,255,.12) inset;
  color:var(--text);
}

/* initials modal */
#initModal{
  position:fixed;inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  background:rgba(0,0,0,.65);
  z-index:50;
}
#initCard{
  width:min(420px, 92vw);
  border-radius:22px;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(0,0,0,.40);
  box-shadow:0 18px 70px rgba(0,0,0,.7);
  padding:16px;
}
#initTitle{
  font-weight:1000;
  letter-spacing:.16em;
  text-transform:uppercase;
  margin-bottom:10px;
}
#initInput{
  width:100%;
  padding:12px 12px;
  border-radius:16px;
  border:1px solid var(--stroke2);
  background:rgba(0,0,0,.22);
  color:var(--text);
  font-weight:900;
  letter-spacing:.18em;
  text-transform:uppercase;
  outline:none;
  font-size:18px;
}
#initActions{
  display:flex;
  gap:10px;
  margin-top:12px;
}
.modalBtn{
  flex:1;
  padding:12px 14px;
  border-radius:16px;
  border:1px solid var(--stroke2);
  background:rgba(0,0,0,.22);
  color:var(--text);
  font-weight:900;
  letter-spacing:.10em;
  cursor:pointer;
  text-transform:uppercase;
}
.modalBtn:hover{filter:brightness(1.08)}
.modalBtn.primary{
  border-color:color-mix(in srgb, var(--accent) 60%, var(--stroke2));
  box-shadow:0 0 0 2px rgba(0,207,255,.12) inset;
}

/* responsive */
@media (max-width: 1200px){
  .grid{grid-template-columns: 1fr}
  .tabs{display:block}
  .panel{display:none}
  .panel.active{display:flex}
  .wrap{padding:12px 14px 76px 14px}
  .panelBody{padding:12px 14px;overflow:hidden;}
}

/* --- PIXEL-NET mobile touch controls (wrapper-only) --- */
.touchControls{
  position: fixed;
  left: 8px; right: 8px; bottom: calc(env(safe-area-inset-bottom, 0px) + 8px);
  padding: 10px; max-width: 1200px; margin: 0 auto;
  display:none;
  gap: 12px;
  align-items: flex-end;
  justify-content: space-between;
  pointer-events:none;
  z-index: 45;
}
@media (max-width: 1100px){
  .touchControls{ display: none; }
}
.touchPad, .touchBtns{ pointer-events:auto; display:flex; gap:10px; }
.dpad{
  width: 176px; height: 176px;
  border-radius: 22px;
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.28);
  backdrop-filter: blur(10px);
  position: relative;
  touch-action: none;
}
.dpad button{
  position:absolute;
  width: 56px; height: 56px;
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.24);
  color: rgba(243,246,255,.92);
  font-weight: 900;
  cursor:pointer;
}
.dpad button:active, .touchBtns button:active{ transform: translateY(1px); }
.dpad .up{ left:60px; top:8px; }
.dpad .down{ left:60px; bottom:8px; }
.dpad .left{ left:8px; top:60px; }
.dpad .right{ right:8px; top:60px; }
.touchBtns{
  flex-direction: column;
  align-items: flex-end;
}
.touchBtns button{
  width: 88px; height: 66px;
  border-radius: 18px;
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.24);
  color: rgba(243,246,255,.92);
  font-weight: 1000;
  letter-spacing:.04em;
  cursor:pointer;
  touch-action:none;
}
.touchHint{
  position:absolute;
  left: 12px;
  bottom: 12px;
  font-size: 12px;
  color: rgba(243,246,255,.72);
  pointer-events:none;
}


/* --- PIXEL-NET swipe controls (wrapper-only, mobile only) --- */
.frame, .mobileFrame, .displayCard, .displayZone, .center { position: relative; }
.swipeLayer{
  position:absolute;
  inset:0;
  z-index: 40;
  display:none;
  pointer-events:none;
  touch-action:none;
}
@media (pointer: coarse){
  .swipeLayer{ display:block; pointer-events:auto; }
}
</style>
</head>

<body>
  <div class="topbar">
    <div>
      <a class="pillBtn" id="exitLink" href="../../index.html"><span class="x">✕</span> EXIT</a>
    </div>

    <div class="titlePill">ROBO ARENA</div>

    <div class="rightPills">
      <div class="playerPill" id="playerPill">PLAYER <strong id="initials">???</strong></div>
    </div>
  </div>

  <div class="wrap">
    <div class="grid">
      <!-- HOW TO -->
      <section class="panel" id="pHow">
        <div class="panelHeader">HOW TO PLAY</div>
        <div class="panelBody">
          <ul class="bullets">
            <li class="bullet"><span class="dot"></span><div class="bulletText">Move with <b>WASD</b>.</div></li>
            <li class="bullet"><span class="dot"></span><div class="bulletText">Shoot with <b>Arrow Keys</b> (twin-stick).</div></li>
            <li class="bullet"><span class="dot"></span><div class="bulletText">Protect humans and survive escalating waves.</div></li>
            <li class="bullet"><span class="dot"></span><div class="bulletText">Mobile: on-screen sticks appear automatically.</div></li>
          </ul>
        </div>
      </section>

      <!-- GAME -->
      <section class="panel active" id="pGame">
        <div class="cabinetOuter">
          <div class="cabinetInner" id="cabinetInner">
            <div class="frameSizer" id="frameSizer">
              <iframe id="gameFrame" src="./game.html" title="Robo-Arena (v2)"></iframe>
        <div class="swipeLayer" data-iframe="gameFrame" aria-hidden="true"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- LEADERBOARD -->
      <section class="panel" id="pLB">
        <div class="panelHeader">LEADERBOARD</div>
        <div class="panelBody">
          <div class="note">Local copy leaderboard (separate from original).</div>
          <div id="lb"></div>
        </div>
      </section>
    </div>
  </div>

  <!-- mobile tabs -->
  <div class="tabs">
    <div class="tabRow">
      <button class="tabBtn" data-target="pHow">How To</button>
      <button class="tabBtn active" data-target="pGame">Game</button>
      <button class="tabBtn" data-target="pLB">Leaderboard</button>
    </div>
  </div>

  <!-- initials modal -->
  <div id="initModal">
    <div id="initCard">
      <div id="initTitle">PLAYER INITIALS</div>
      <input id="initInput" maxlength="3" placeholder="---" autocomplete="off" />
      <div id="initActions">
        <button class="modalBtn" id="initCancel">EXIT</button>
        <button class="modalBtn primary" id="initSave">SAVE</button>
      </div>
    </div>
  </div>

<script>
(() => {
  /* ---------- Mobile tabs ---------- */
  const tabBtns = Array.from(document.querySelectorAll('.tabBtn'));
  const panels = ['pHow','pGame','pLB'].map(id=>document.getElementById(id)).filter(Boolean);
  const setActive = (id) => {
    panels.forEach(p=>p.classList.toggle('active', p.id===id));
    tabBtns.forEach(b=>b.classList.toggle('active', b.dataset.target===id));
  };
  tabBtns.forEach(b=>b.addEventListener('click', ()=>setActive(b.dataset.target)));

  /* ---------- Initials (canonical) ---------- */
  const PRIMARY = 'playerInitials';
  const MIRROR  = 'PIXELNET_INITIALS';
  const norm = (v) => (v||'').toString().trim().toUpperCase().replace(/[^A-Z0-9]/g,'').slice(0,3);
  const getInitials = () => norm(localStorage.getItem(PRIMARY) || localStorage.getItem(MIRROR) || '');
  const setInitials = (v) => {
    v = norm(v);
    if(!v) return;
    localStorage.setItem(PRIMARY, v);
    localStorage.setItem(MIRROR, v);
  };

  const initialsEl = document.getElementById('initials');
  const renderInitials = () => { initialsEl.textContent = getInitials() || '???'; };
  renderInitials();
  window.addEventListener('storage', (e)=>{ if(e.key===PRIMARY || e.key===MIRROR) renderInitials(); });

  /* initials modal open: click PLAYER pill */
  const playerPill = document.getElementById('playerPill');
  const modal = document.getElementById('initModal');
  const input = document.getElementById('initInput');
  const btnSave = document.getElementById('initSave');
  const btnCancel = document.getElementById('initCancel');

  const openModal = () => {
    input.value = getInitials() || '';
    modal.style.display = 'flex';
    setTimeout(()=>input.focus(), 50);
  };
  const closeModal = () => { modal.style.display = 'none'; };

  playerPill.addEventListener('click', openModal);
  btnCancel.addEventListener('click', closeModal);
  modal.addEventListener('click', (e)=>{ if(e.target===modal) closeModal(); });

  btnSave.addEventListener('click', ()=>{
    setInitials(input.value);
    renderInitials();
    closeModal();
  });
  input.addEventListener('keydown', (e)=>{
    if(e.key==='Enter'){ e.preventDefault(); btnSave.click(); }
    if(e.key==='Escape'){ e.preventDefault(); closeModal(); }
  });

  /* ---------- Leaderboard (localStorage top-10) ---------- */
  const lbEl = document.getElementById('lb');

  const slug = (() => {
    try{
      const parts = location.pathname.split('/').filter(Boolean);
      const gi = parts.lastIndexOf('games');
      if(gi>=0 && parts[gi+1]) return parts[gi+1];
    }catch(_){}
    return 'unknown';
  })();

  const KEY = `LB_${slug}`;
  const load = () => { try{ return JSON.parse(localStorage.getItem(KEY)||'[]'); }catch(_){ return []; } };
  const save = (arr) => { try{ localStorage.setItem(KEY, JSON.stringify(arr)); }catch(_){ } };

  const renderLB = () => {
    const rows = load().slice(0,10);
    if(!rows.length){
      lbEl.innerHTML = `<div class="lbEmpty">No scores yet.</div>`;
      return;
    }
    lbEl.innerHTML = rows.map((r,i)=>{
      const who = String(r.initials||r.name||'???').toUpperCase().slice(0,3);
      const sc  = Math.floor(Number(r.score||0));
      return `<div class="lbRow"><div class="lbRank">#${i+1}</div><div class="lbWho">${who}</div><div class="lbScore">${sc}</div></div>`;
    }).join('');
  };
  renderLB();

  /* score intake + dedupe */
  let lastSig = '';
  let lastAt = 0;
  const addScore = (rawScore) => {
    const score = Math.max(0, Math.floor(Number(rawScore)||0));
    const initials = getInitials() || '???';
    const now = Date.now();
    const sig = `${initials}:${score}`;
    if(sig===lastSig && (now-lastAt) < 1200) return;
    lastSig = sig; lastAt = now;

    const rows = load();
    rows.push({ initials, score, t: now });
    rows.sort((a,b)=> (b.score||0)-(a.score||0) || (a.t||0)-(b.t||0));
    save(rows.slice(0,10));
    renderLB();
  };

  window.addEventListener('message', (e)=>{
    const d = e.data || {};
    if(d.type === 'GAME_OVER_SCORE' && d.score != null){
      addScore(d.score);
    }
  });

  /* ---------- Uniform aspect-fit sizing (NO stretch) ---------- */
  const cabinetInner = document.getElementById('cabinetInner');
  const frameSizer = document.getElementById('frameSizer');

  const ASPECT = 4/3;

  function fit(){
    const r = cabinetInner.getBoundingClientRect();
    const pad = 0;
    const availW = Math.max(0, r.width - pad*2);
    const availH = Math.max(0, r.height - pad*2);

    let w = availW;
    let h = w / ASPECT;

    if(h > availH){
      h = availH;
      w = h * ASPECT;
    }

    w = Math.max(240, w);
    h = Math.max(180, h);

    frameSizer.style.setProperty('--fitW', `${Math.floor(w)}px`);
    frameSizer.style.setProperty('--fitH', `${Math.floor(h)}px`);
  }

  const ro = new ResizeObserver(fit);
  ro.observe(cabinetInner);
  window.addEventListener('resize', fit);
  fit();
})();

/* ---------- Exit: force top-level navigation ---------- */
(function(){
  const a = document.getElementById('exitLink');
  if(!a) return;
  a.addEventListener('click', (e) => {
    e.preventDefault();
    const href = a.getAttribute('href') || '../../index.html';
    try{ window.top.location.href = href; }
    catch(_){ window.location.href = href; }
  });
})();

</script>

<script>


/* --- PIXEL-NET swipe controls: wrapper-only, mobile only (no visual buttons) --- */
(function(){
  const isCoarse = () => window.matchMedia && window.matchMedia('(pointer: coarse)').matches;
  if(!isCoarse()) return;

  const layers = Array.from(document.querySelectorAll('.swipeLayer[data-iframe]'));
  if(!layers.length) return;

  // Map: swipe direction -> Arrow keys. Tap -> Space. Two-finger tap -> X.
  const KEY = {
    up:    { key:'ArrowUp',   code:'ArrowUp'   },
    down:  { key:'ArrowDown', code:'ArrowDown' },
    left:  { key:'ArrowLeft', code:'ArrowLeft' },
    right: { key:'ArrowRight',code:'ArrowRight'}
  };
  const TAP_A = { key:' ', code:'Space' };
  const TAP_B = { key:'x', code:'KeyX' };

  function getTargetWindow(layer){
    const id = layer.getAttribute('data-iframe');
    const iframe = document.getElementById(id);
    if(!iframe) return null;
    try{ iframe.contentWindow?.focus?.(); }catch(_){}
    try{ return iframe.contentWindow; }catch(_){ return null; }
  }

  function dispatchKey(w, type, key, code){
    if(!w) return;
    const evInit = { key, code, bubbles:true, cancelable:true };
    let ev;
    try{ ev = new w.KeyboardEvent(type, evInit); }
    catch(_){ ev = new KeyboardEvent(type, evInit); }
    try{ w.dispatchEvent(ev); }catch(_){}
    try{ w.document?.dispatchEvent(ev); }catch(_){}
  }

  function pulse(w, key, code){
    dispatchKey(w, 'keydown', key, code);
    // short pulse avoids "stuck" for tap actions
    setTimeout(()=>dispatchKey(w,'keyup',key,code), 32);
  }

  function install(layer){
    const w = () => getTargetWindow(layer);
    let activeDir = null;        // 'up'|'down'|'left'|'right'|null
    let down = false;
    let startX = 0, startY = 0, startT = 0;
    let pointers = new Set();

    const THRESH = 18;           // px before direction engages
    const TAP_DIST = 10;         // px max move for a tap
    const TAP_TIME = 200;        // ms max for a tap

    function setDir(dir){
      if(dir === activeDir) return;
      const win = w();
      if(activeDir){
        const k = KEY[activeDir];
        dispatchKey(win,'keyup',k.key,k.code);
      }
      activeDir = dir;
      if(activeDir){
        const k = KEY[activeDir];
        dispatchKey(win,'keydown',k.key,k.code);
      }
    }

    function clearDir(){
      setDir(null);
    }

    layer.addEventListener('pointerdown', (e)=>{
      if(!isCoarse()) return;
      e.preventDefault();
      layer.setPointerCapture?.(e.pointerId);
      pointers.add(e.pointerId);

      // If a second finger comes down, treat as "B" on release (two-finger tap)
      if(pointers.size === 1){
        down = true;
        startX = e.clientX; startY = e.clientY; startT = performance.now();
        activeDir = null;
      }
    }, { passive:false });

    layer.addEventListener('pointermove', (e)=>{
      if(!down) return;
      e.preventDefault();

      const dx = e.clientX - startX;
      const dy = e.clientY - startY;
      const adx = Math.abs(dx), ady = Math.abs(dy);

      if(adx < THRESH && ady < THRESH){
        // still in deadzone, don't engage movement yet
        return;
      }

      // Dominant axis decides direction (prevents diagonal jitter)
      if(adx >= ady){
        setDir(dx > 0 ? 'right' : 'left');
      }else{
        setDir(dy > 0 ? 'down' : 'up');
      }
    }, { passive:false });

    function endPointer(e){
      if(!pointers.has(e.pointerId)) return;
      pointers.delete(e.pointerId);

      // Only evaluate tap on the *last* finger up.
      if(pointers.size > 0) return;

      const win = w();
      const dt = performance.now() - startT;
      const dx = (e.clientX - startX);
      const dy = (e.clientY - startY);
      const dist = Math.hypot(dx, dy);

      // Release movement key if held
      clearDir();
      down = false;

      // Tap actions: 1-finger tap => A, 2-finger tap => B
      if(dt <= TAP_TIME && dist <= TAP_DIST){
        // If the gesture began as multi-touch, send B; otherwise A.
        // (We can't reliably know "began" here; approximate: if the pointerup was from a multi-touch session.)
        // We treat a quick second finger tap as B by checking if more than 1 pointer was active at any point.
        // For minimalism: if the pointer was NOT primary (rare), still treat as B.
        const asB = (e.isPrimary === false);
        const k = asB ? TAP_B : TAP_A;
        pulse(win, k.key, k.code);
      }
    }

    layer.addEventListener('pointerup', (e)=>{ e.preventDefault(); endPointer(e); }, { passive:false });
    layer.addEventListener('pointercancel', (e)=>{ e.preventDefault(); endPointer(e); }, { passive:false });

    // Safety: if the page loses visibility, release movement keys.
    document.addEventListener('visibilitychange', ()=>{
      if(document.hidden){
        const win = w();
        if(activeDir){
          const k = KEY[activeDir];
          dispatchKey(win,'keyup',k.key,k.code);
        }
        activeDir = null;
        down = false;
        pointers.clear();
      }
    });
  }

  layers.forEach(install);
})();

</script>

<!-- Mobile touch controls (wrapper-only). Generates keyboard events for the game iframe. -->
<div class="touchControls" id="touchControls" aria-hidden="true">
  <div class="touchPad">
    <div class="dpad" id="dpad">
      <button class="up" data-key="ArrowUp" data-code="ArrowUp">▲</button>
      <button class="down" data-key="ArrowDown" data-code="ArrowDown">▼</button>
      <button class="left" data-key="ArrowLeft" data-code="ArrowLeft">◀</button>
      <button class="right" data-key="ArrowRight" data-code="ArrowRight">▶</button>
    </div>
  </div>
  <div class="touchBtns">
    <button data-key=" " data-code="Space">A</button>
    <button data-key="x" data-code="KeyX">B</button>
  </div>
</div>

</body>
</html>
